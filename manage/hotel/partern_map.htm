<!DOCTYPE html><html><head>    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />    <title>拾取商户地址坐标系统</title>    <style type="text/css">        body, html,#allmap {width: 100%;height: 100%;overflow: hidden;margin:0;}        #l-map{height:100%;width:68%;float:left;border-right:2px solid #bcbcbc;}        #r-result{height:100%;width:31.7%;float:left; overflow:scroll; overflow-y:scroll;}        #resultNum{float:right; color: #7797d3; font: 12px arial,sans-serif;}    </style>    <script src="http://api.map.baidu.com/api?v=1.4" type="text/javascript"></script>    <script src="jquery-1.4.4.min.js" type="text/javascript"></script></head><body onunload="willReturnValue()" >        <div id="l-map"></div>        <div id="result">            <input type="button"  id="query" value="查询" onclick="search()"/>            <input type="text"  id="keyWords"/>            <div id="resultNum" style=""></div>        </div>        <div id="r-result"></div>    <script type="text/javascript">        function $(id) {            return document.getElementById(id);//定义$        }        //var parent_city = window.opener.document.getElementById("txtmap_city").value; //此种写法不适合模态窗口。        //var parent_city = window.dialogArguments.document.getElementById("txtmap_city").value;        var map = new BMap.Map("l-map");        map.centerAndZoom('山东', 16);        map.addControl(new BMap.NavigationControl());        map.addControl(new BMap.ScaleControl());        map.enableScrollWheelZoom();        var city = new BMap.LocalSearch(map, { renderOptions: { map: map, panel: "", autoViewport: true }, pageCapacity: 100, onSearchComplete: function (w) {            var l = w.getCurrentNumPois();            if (l > 0) {                var P = '<ul>'                for (var i = 0; i < l; i++) {                    var h = w.getPoi(i);                    var q = h.title;                    var u = h.address;                    var n = h.phoneNumber;                    var v = h.point;                    var A = v.lng + "," + v.lat;                    var x = q;                    var j = h.type;                    var t = "地址";                    if (x.length > 20) {                        x = x.substring(0, 17) + "..."                    }                    var temp=i+1;                    P += '<li id="no' + i + '" style="list-style: none; display: list-item;">';                    P += '<div id="no_' + i + '">';                    P += '<span id="mk_' + i + '" style="font-size:12px; font-famliy:arial, sans-serif; line-height:18px; font-weight:bold;">' +temp+ '</span>.';                    P += '<a href="javascript:void(0)" title="' + q + '" style="font-size:12px;">' + x + "</a>";                    P += "<p >";                    P += "<b style='font-size:12px; font-famliy:arial, sans-serif; line-height:18px; font-weight:bold;'>" + t + ":</b><span style='color:#666; ling-height:18px; font-size: 12px; font-family: arial, sans-serif;'>" + u + "</span>";                    n ? P += "<br/><b style='font-size:12px; font-famliy:arial, sans-serif; line-height:18px; font-weight:bold;'>电话：" + n + "</b>" : null;                    P += "<br/><b style='font-size:12px; font-famliy:arial, sans-serif; line-height:18px; font-weight:bold;'>经纬度:<input type='text' readonly='readonly' value='" + v.lng + "," + v.lat + "' id='tr" + i + "'><input type='button' value='取此坐标' onclick='copyPoint(" + i + ");'></b><br/>";                    P += "</p>";                    P += "</div>";                    P += "</li>";                }                P += "</ul>";                document.getElementById("r-result").innerHTML = P;                document.getElementById("resultNum").innerHTML = "共找到" + i + "条结果";            } else {                var n = "<p style='color:red; font-size:12px; font-famliy:arial, sans-serif;'>在" + parent_city + "及全国没有找到相关的地点。<br/><strong style='color:#7797d3; font-size:12px; font-famliy:arial, sans-serif;'>友情提示：</strong>,您还可以尝试通过景区或者商户<b style='color:black;'>地址</b>进行搜索,试试看!</p>";                document.getElementById("r-result").innerHTML = n;            }        }        });        var ac=new BMap.Autocomplete({            "input": "keyWords",             "location":map        });        document.onkeydown = function (event) {            var e = event || window.event || arguments.callee.caller.arguments[0];            if (e && e.keyCode == 13) {                search();            }        };        map.addEventListener("tilesloaded", function () {            var keyWords = document.getElementById("keyWords").value;            if (keyWords == "" && keyWords.length <= 0) {                //var shopName = window.opener.document.getElementById("txtName").value;//此种写法不适合模态窗口。                var shopName = window.dialogArguments.document.getElementById("txtName").value;                document.getElementById("keyWords").value = shopName;            }        });        function search() {            var s = $("keyWords").value;            if (s == "") {                alert("请输入查询关键词!");                document.getElementById("keyWords").focus();                return;            }            city.search(s);        }        function copyPoint(id) {            var point = $("tr" + id).value;            willReturnValue(point);        }        function willReturnValue(point) {            if (point != null) {                window.returnValue = point;            }            window.close();        }    </script></body></html>